<link rel="import" href="/static/elements/polymer/polymer/polymer.html"/>
<link rel="import" href="/static/elements/app-ajax.html"/>

<polymer-element name="ajax-json-form" extends="form" on-submit="{{onFormSubmit}}" attributes="action">
	<template>
		<content></content>
		<app-ajax url="{{action}}" method="POST"></app-ajax>
	</template>
	<script>
		Polymer({
			onFormSubmit: function(e) {
				e.preventDefault();
				var jsonData = this.serializeObject(),
					formData = new FormData();

				formData.append('data', JSON.stringify(jsonData));
				$$.toArray(this.elements)
					.filter(function(element){
						return element.type === 'file';
					})
					.forEach(function(element){
						formData.append(element.name, element.files[0]);
					});
			},
			serializeObject: function() {
				return $$.serializeObject.call(this);
			}
		});
	</script>
</polymer-element>