<link rel="import" href="/static/elements/polymer/polymer/polymer.html"/>
<link rel="import" href="/static/elements/app-router/app-router.html"/>
<link rel="import" href="/static/elements/html5-history-anchor/html5-history-anchor.html"/>
<link rel="import" href="/static/elements/polymer/core-icon-button/core-icon-button.html"/>
<link rel="import" href="/static/elements/dialog-login.html"/>
<link rel="import" href="/static/elements/app-globals.html"/>
<link rel="import" href="/static/elements/science-app.html"/>

<polymer-element name="app-bar">
	<template>
		<style>
			:host {
				width: 220px;
				display: flex;
				align-items: center;
				justify-content: space-between;
			}
		</style>
		<template if="{{!data.user}}">
			<div class="color-white action" id="signIn" on-tap="{{onSignInTap}}">Войти</div>
			<div class="color-white">
				<a is="html5-history-anchor" href="/signup" pushstate popstate>Регистрация</a>
			</div>
			<core-icon-button class="color-white" icon="search"></core-icon-button>
			<dialog-login id="dialogLogin"></dialog-login>
		</template>
		<template if="{{data.user}}">
			<div class="color-white">Привет мир!</div>
			<div class="color-white action" id="signOut" on-tap="{{onSignOutTap}}">Выйти</div>
		</template>
		<app-globals id="globals"></app-globals>
		<app-ajax id="ajax" url="/api/logout" method="GET" on-core-response="{{onSignOutResponse}}"></app-ajax>
	</template>
	<script>
		Polymer({
			ready: function() {
				var self = this;
				self.data = self.$.globals.data;
			},
			onSignInTap: function(event, detail, sender) {
				this.$.dialogLogin.open();
			},
			onSignOutTap: function() {
				this.$.ajax.makeRequest();
			},
			onSignOutResponse: function() {
				this.$.globals.data.user = null;
			}
		});
	</script>
</polymer-element>