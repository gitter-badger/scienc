<link rel="import" href="/static/elements/polymer/polymer/polymer.html"/>
<link rel="import" href="/static/elements/app-router/app-router.html"/>
<link rel="import" href="/static/elements/html5-history-anchor/html5-history-anchor.html"/>
<link rel="import" href="/static/elements/polymer/core-icon-button/core-icon-button.html"/>
<link rel="import" href="/static/elements/polymer/core-ajax/core-ajax.html"/>
<link rel="import" href="/static/elements/polymer/core-overlay/core-overlay.html"/>


<polymer-element name="app-bar" attributes="name" >
	<template>
		<style>
			:host {
				width: 220px;
				display: flex;
				align-items: center;
				justify-content: space-between;
			}
		</style>
		<div class="color-white action" id="signIn" on-tap="{{onSignInTap}}">Войти</div>
		<div class="color-white">
			<a is="html5-history-anchor" href="/signup" pushstate popstate>Регистрация</a>
		</div>
		<core-icon-button class="color-white" icon="search"></core-icon-button>
		<core-overlay opened="false" layered backdrop id="loginDialog" class="">
			<div class="login-dialog">
				<h2 class="login-dialog-header">Log in</h2>
				<form action="/api/login" on-submit="{{onLoginFormSubmit}}" class="login-dialog-form">
					<input class="login-dialog-input"
						   type="email"
						   id="email"
						   placeholder="E-mail"
						   autofocus value="{{email}}"
						   required>
					<input class="login-dialog-input"
						   type="password"
						   id="password"
						   placeholder="Password"
						   value="{{password}}"
						   required>
					<button class="button submit login-dialog-submit"
							id="login"
							type="submit">
							Войти
					</button>
				</form>
				<footer class="row between">
					<a is="html5-history-anchor" href="/signup" pushstate popstate>Восстановить пароль</a>
					<a is="html5-history-anchor" href="/signup" pushstate popstate>Зарегистрироваться</a>
				</footer>
				<div class="login-dialog-close action">X</div>
				<core-ajax class="" method="POST" url="/api/login" headers='{"X-Requested-With": "XMLHttpRequest"}' id="ajax" body="{'email': {{email}}, 'password': {{password}} }"></core-ajax>
			</div>
		</core-overlay>
	</template>
	<script>
		Polymer({
			onSignInTap: function(event, detail, sender) {
				this.$.loginDialog.open();
			},
			onLoginFormSubmit: function(e) {
				var self = this;
				self.$.ajax.go();
				e.preventDefault();
			}
		});
	</script>
</polymer-element>